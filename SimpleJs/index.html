<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Привіт JS</title>
    <link href="/css/site.css" rel="stylesheet" />
    <link href="/css/cropper.min.css" rel="stylesheet" />
    <style>
        .container {
            max-width: 500px;
            margin: auto;
            text-align: center;
        }

        img {
            max-width: 100%;
            display: block;
            margin: auto;
        }

    </style>

</head>
<body>
    <h1>Привіт JavaScript!</h1>

    <div class="container">
        <button id="leftRotate">Left rotate</button>
        <button id="getData">GetData</button>
        <input type="file" id="uploadImage" accept="image/*">
        <br><br>
        <img id="image" src="/images/redhead.jpg" alt="Upload an image">
    </div>

    <script src="/js/cropper.min.js"></script>
    <script>
        let cropper;
        let uploadedImageURL;
        const leftRotate = document.getElementById("leftRotate");
        const image = document.getElementById('image');
        const uploadImage = document.getElementById('uploadImage');
        const getData = document.getElementById('getData');

        cropper = new Cropper(image, {
            aspectRatio: 1, // співідношення сторін 1/1 тобто квадрат
            viewMode: 1 //режим відображення
        });

        leftRotate.onclick = function (e) {
            if (cropper) {
                cropper.rotate(90);
            }
        }

        getData.onclick = function(e) {
            if (cropper) {
                var base64 = cropper.getCroppedCanvas().toDataURL();
                cropper.getCroppedCanvas().toBlob(function (blob) {
                    var file_blob = new File([blob], "some_random_file_name.jpg");
                    console.log("file: ", file_blob);
                });
                console.log("Get data url", base64);
                //console.log("Get blob image", blob);
            }
        }

        uploadImage.onchange = (event) => {    //Функція обробник події - у змінну event прилітає інформація

            const { target } = event;
            //console.log("Select image", target); //target - сам об'єкт на якому виникла подія
            const { files } = target;
            //console.log("Select files", files);
            const file = files[0];
            if (file) {
                if (/^image\/\w+/.test(file.type)) {

                    console.log("uploadedImageURL", uploadedImageURL);
                    if (uploadedImageURL) {
                        URL.revokeObjectURL(uploadedImageURL);
                    }

                    image.src = uploadedImageURL = URL.createObjectURL(file);

                    if (cropper) {
                        cropper.destroy();
                    }

                    cropper = new Cropper(image, {
                        aspectRatio: 1, // співідношення сторін 1/1 тобто квадрат
                        viewMode: 1 //режим відображення
                    });
                }
                else {
                    window.alert('Please choose an image file.');
                }
            }
        }

    </script>
</body>
</html>